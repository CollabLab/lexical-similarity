<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/custom.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <script type="text/javascript" src="../static/js/dygraph-combined-dev.js"></script>
    <title>Similarity</title>
</head>
    <body>
    {{ navbar|safe }}
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Data Visualization&nbsp;
                    <small>Lexical Similarity</small>
                </h1>
                <ol class="breadcrumb">
                    <li><a href="/">Home</a></li>
                    <li><a href="/visualize">Visualize Data</a></li>
                    <li><a href="graph">Generate Graphs</a></li>
                    <li class="active">Lexical Similarity</li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <div id="graphdiv" style="width:700px;"></div>
            </div>
            <div class="col-md-3">
                <div id= "annotation" class="annotation">
                </div>
            </div>
        </div>
    <script type="text/javascript">
        // lexical similarity to generate the graph
        var data = {{ data|safe }}

        // formatted turn by turn conversation. tbt[0] = turn 1
        var tbt = {{ tbt|safe }}

        // index of maximum similarity values
        var max = {{ max|safe }}
        var secondMax = {{ secondMax|safe }}

        var annotationMax = function () {
            var text = buildAnnotation(max, tbt)
            document.getElementById("annotation").innerHTML = text;
            document.getElementById('annotation').style.display = "block"
        }

        var annotationSecondMax = function () {
            var text = buildAnnotation(secondMax, tbt)
            document.getElementById("annotation").innerHTML = text;
            document.getElementById('annotation').style.display = "block"
        }

        function buildAnnotation(turnIndex, tbtConv){
            var turn = turnIndex-1
            var text = "<h4>Turn "+turnIndex+"</h4><ul>";

            if (turn-1 >= 0) {
                var index = turn-1;
            }
            else {
                var index = turn;
            }

            if (turn+1 < tbt.length) {
                var end = turn+1;
            }
            else {
                var end = turn;
            }

            for (index; index <= end; index++) {
                text += "<li>" + tbt[index] + "</li>";
            }
            text += "</ul>";

            return text;
        }

        g = new Dygraph(
          document.getElementById("graphdiv"),
            data,
              {
                labels: [ "Turn", "Similarity"],
                ylabel: 'Similarity',
                xlabel: 'Turn Number',
                title: 'Lexical Similarity',
                digitsAfterDecimal: 5
            }     
        );
        g.ready(function() {
            g.setAnnotations([
            {
              series: "Similarity",
              x: max,
              shortText: max,
              text: "Click here",
              clickHandler: annotationMax
            },
            {
              series: "Similarity",
              x: secondMax,
              shortText: secondMax,
              text: "Click here",
              clickHandler: annotationSecondMax
            }
            ]);
          });
    </script>
    </div>
    {{ footer|safe }}
    </body>
</html>