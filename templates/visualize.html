 <!DOCTYPE html>
<html>
<head>
    <title>Similarity - Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/custom.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <script type="text/javascript" src="../static/js/dygraph-combined-dev.js"></script>
</head>
<body>
	{{ navbar|safe }}
    <div class="container">
    	<div calss="row">
    	    <div class="col-lg-12">
    	        <h1 class="page-header">Data Visualization&nbsp;
    	            <small>Lexical Similarity</small>
    	        </h1>
    	        <ol class="breadcrumb">
    	            <li><a href="/">Home</a></li>
    	            <li class="active">Visualize Data</li>
    	        </ol>
    	    </div>
    	</div>
    	<div class="row">
    	    <div class="col-lg-12 text-center">
    	        <a href="/visualize/graph" class= "btn btn-default">
    	          Visualize Lexical Similarity
    	        </a>
    	        <p>
    	          <small>
    	            Upload your conversation to visualize lexical similarity
    	          </small>
    	        </p>
    	    </div>
    	</div>
    	<div class="row">
    	    <div class="col-lg-12 text-center">
    	        <h2>Examples</h2>
    	    </div>
    	</div>
    	<div class="row">
    	    <div class="col-lg-12">
    	        <h4>Similarity through a conversation</h4>
    	    </div>
    	</div>
    	<div class="row">
    	    <div class="col-md-8">
    	    	<div id="graph" style="width: 100%"></div>
    	        <p>Explanation</p>
    	    </div>
            <div class="col-md-4">
                <div id="annotation">
                </div>
            </div>
    	</div>
    </div>
    <script type="text/javascript">
        // lexical similarity to generate the graph
        var data = {{ data|safe }}

        // formatted turn by turn conversation. tbt[0] = turn 1
        var tbt = {{ tbt|safe }}
        document.getElementById("annotation").innerHTML = buildAnnotation(tbt);

        function buildAnnotation(tbtConv){
            var text = "<div class='annotation'>";

            for (var index =0; index < tbtConv.length; index++) {
                text += '<span id='+(index+1)+'>' + tbtConv[index] + "</span><br />";
            }
            text += "</div>";

            return text;
        }

        g = new Dygraph(
          document.getElementById("graph"),
            data,
              {
                labels: [ "Turn", "Similarity"],
                ylabel: 'Similarity',
                xlabel: 'Turn Number',
                digitsAfterDecimal: 5
            }     
        );
        function unhighlight () {
            for (var index=1; index <= tbt.length; index++ ){
                document.getElementById(index).className = "";
            }
        }
        g.updateOptions( {
            highlightCallback: function(event, x, points, row, seriesName) {
                // document.getElementById('annotation').innerHTML = "<div class='annotation'>"+tbt[x-4]+"<br>"+tbt[x-3]+"<br>"+tbt[x-2]+"<br>"+tbt[x-1]+"</div>";
                unhighlight();
                var target;
                if (x > 0){
                    if ((x-1)>0 && (x-2)>0 && (x-3)>0){
                        document.getElementById(x).className = "highlight";
                        document.getElementById(x-1).className = "highlight";
                        document.getElementById(x-2).className = "highlight";
                        document.getElementById(x-3).className = "highlight";
                        target = document.getElementById(x-3);
                        target.parentNode.scrollTop = target.offsetTop;
                    }
                    else if ((x-1)>0 && (x-2)>0 && (x-3)<=0){
                        document.getElementById(x).className = "highlight";
                        document.getElementById(x-1).className = "highlight";
                        document.getElementById(x-2).className = "highlight";
                        target = document.getElementById(x-2);
                        target.parentNode.scrollTop = target.offsetTop;
                    }
                    else if ((x-1)>0 && (x-2)<=0 && (x-3)<=0){
                        document.getElementById(x).className = "highlight";
                        document.getElementById(x-1).className = "highlight";
                        target = document.getElementById(x-1);
                        target.parentNode.scrollTop = target.offsetTop;
                    }
                    else if ((x-1)<=0 && (x-2)<=0 && (x-3)<=0){
                        document.getElementById(x).className = "highlight";
                        target = document.getElementById(x);
                        target.parentNode.scrollTop = target.offsetTop;
                    }
                }
            },
            unhighlightCallback: function(event) {
                unhighlight(); 
            }
        });
    </script>
    {{ footer|safe }}
</body>
</html>